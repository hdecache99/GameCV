{"ast":null,"code":"import { Color } from '../../../../color/Color.mjs';\nimport { Matrix } from '../../../../maths/matrix/Matrix.mjs';\nimport { Texture } from '../../../../rendering/renderers/shared/texture/Texture.mjs';\nimport { warn } from '../../../../utils/logging/warn.mjs';\nimport { FillGradient } from '../../../graphics/shared/fill/FillGradient.mjs';\nimport { FillPattern } from '../../../graphics/shared/fill/FillPattern.mjs';\n\"use strict\";\nconst PRECISION = 1e5;\nfunction getCanvasFillStyle(fillStyle, context, textMetrics, padding = 0) {\n  if (fillStyle.texture === Texture.WHITE && !fillStyle.fill) {\n    return Color.shared.setValue(fillStyle.color).setAlpha(fillStyle.alpha ?? 1).toHexa();\n  } else if (!fillStyle.fill) {\n    const pattern = context.createPattern(fillStyle.texture.source.resource, \"repeat\");\n    const tempMatrix = fillStyle.matrix.copyTo(Matrix.shared);\n    tempMatrix.scale(fillStyle.texture.frame.width, fillStyle.texture.frame.height);\n    pattern.setTransform(tempMatrix);\n    return pattern;\n  } else if (fillStyle.fill instanceof FillPattern) {\n    const fillPattern = fillStyle.fill;\n    const pattern = context.createPattern(fillPattern.texture.source.resource, \"repeat\");\n    const tempMatrix = fillPattern.transform.copyTo(Matrix.shared);\n    tempMatrix.scale(fillPattern.texture.frame.width, fillPattern.texture.frame.height);\n    pattern.setTransform(tempMatrix);\n    return pattern;\n  } else if (fillStyle.fill instanceof FillGradient) {\n    const fillGradient = fillStyle.fill;\n    const isLinear = fillGradient.type === \"linear\";\n    const isLocal = fillGradient.textureSpace === \"local\";\n    let width = 1;\n    let height = 1;\n    if (isLocal && textMetrics) {\n      width = textMetrics.width + padding;\n      height = textMetrics.height + padding;\n    }\n    let gradient;\n    let isNearlyVertical = false;\n    if (isLinear) {\n      const {\n        start,\n        end\n      } = fillGradient;\n      gradient = context.createLinearGradient(start.x * width, start.y * height, end.x * width, end.y * height);\n      isNearlyVertical = Math.abs(end.x - start.x) < Math.abs((end.y - start.y) * 0.1);\n    } else {\n      const {\n        center,\n        innerRadius,\n        outerCenter,\n        outerRadius\n      } = fillGradient;\n      gradient = context.createRadialGradient(center.x * width, center.y * height, innerRadius * width, outerCenter.x * width, outerCenter.y * height, outerRadius * width);\n    }\n    if (isNearlyVertical && isLocal && textMetrics) {\n      const ratio = textMetrics.lineHeight / height;\n      for (let i = 0; i < textMetrics.lines.length; i++) {\n        const start = (i * textMetrics.lineHeight + padding / 2) / height;\n        fillGradient.colorStops.forEach(stop => {\n          const globalStop = start + stop.offset * ratio;\n          gradient.addColorStop(\n          // fix to 5 decimal places to avoid floating point precision issues\n          Math.floor(globalStop * PRECISION) / PRECISION, Color.shared.setValue(stop.color).toHex());\n        });\n      }\n    } else {\n      fillGradient.colorStops.forEach(stop => {\n        gradient.addColorStop(stop.offset, Color.shared.setValue(stop.color).toHex());\n      });\n    }\n    return gradient;\n  }\n  warn(\"FillStyle not recognised\", fillStyle);\n  return \"red\";\n}\nexport { getCanvasFillStyle };","map":{"version":3,"names":["PRECISION","getCanvasFillStyle","fillStyle","context","textMetrics","padding","texture","Texture","WHITE","fill","Color","shared","setValue","color","setAlpha","alpha","toHexa","pattern","createPattern","source","resource","tempMatrix","matrix","copyTo","Matrix","scale","frame","width","height","setTransform","FillPattern","fillPattern","transform","FillGradient","fillGradient","isLinear","type","isLocal","textureSpace","gradient","isNearlyVertical","start","end","createLinearGradient","x","y","Math","abs","center","innerRadius","outerCenter","outerRadius","createRadialGradient","ratio","lineHeight","i","lines","length","colorStops","forEach","stop","globalStop","offset","addColorStop","floor","toHex","warn"],"sources":["C:\\Users\\emalv\\OneDrive\\Desktop\\Portafolio\\cv-ciudad\\node_modules\\pixi.js\\src\\scene\\text\\canvas\\utils\\getCanvasFillStyle.ts"],"sourcesContent":["import { Color } from '../../../../color/Color';\nimport { Matrix } from '../../../../maths/matrix/Matrix';\nimport { Texture } from '../../../../rendering/renderers/shared/texture/Texture';\nimport { warn } from '../../../../utils/logging/warn';\nimport { FillGradient } from '../../../graphics/shared/fill/FillGradient';\nimport { FillPattern } from '../../../graphics/shared/fill/FillPattern';\n\nimport type { ICanvasRenderingContext2D } from '../../../../environment/canvas/ICanvasRenderingContext2D';\nimport type { ConvertedFillStyle } from '../../../graphics/shared/FillTypes';\nimport type { CanvasTextMetrics } from '../CanvasTextMetrics';\n\n// 5 decimal places\nconst PRECISION = 100000;\n\n/**\n * Converts a PixiJS fill style into a Canvas-compatible fill style.\n * Handles solid colors, textures, patterns, and gradients.\n * @param fillStyle - The PixiJS fill style to convert\n * @param context - The canvas rendering context\n * @param textMetrics - Metrics about the text being rendered\n * @param padding - Padding to add to the text metrics (used to ensure that the gradient accommodates the stroke width)\n * @returns Canvas-compatible fill style (string, CanvasGradient, or CanvasPattern)\n */\nexport function getCanvasFillStyle(\n    fillStyle: ConvertedFillStyle,\n    context: ICanvasRenderingContext2D,\n    textMetrics?: CanvasTextMetrics,\n    padding = 0\n): string | CanvasGradient | CanvasPattern\n{\n    // Solid color fill\n    if (fillStyle.texture === Texture.WHITE && !fillStyle.fill)\n    {\n        return Color.shared.setValue(fillStyle.color).setAlpha(fillStyle.alpha ?? 1).toHexa();\n    }\n    // Basic texture fill\n    else if (!fillStyle.fill)\n    {\n        const pattern = context.createPattern(fillStyle.texture.source.resource, 'repeat');\n        const tempMatrix = fillStyle.matrix.copyTo(Matrix.shared);\n\n        tempMatrix.scale(fillStyle.texture.frame.width, fillStyle.texture.frame.height);\n        pattern.setTransform(tempMatrix);\n\n        return pattern;\n    }\n    // Pattern fill\n    else if (fillStyle.fill instanceof FillPattern)\n    {\n        const fillPattern = fillStyle.fill;\n        const pattern = context.createPattern(fillPattern.texture.source.resource, 'repeat');\n        const tempMatrix = fillPattern.transform.copyTo(Matrix.shared);\n\n        tempMatrix.scale(\n            fillPattern.texture.frame.width,\n            fillPattern.texture.frame.height\n        );\n\n        pattern.setTransform(tempMatrix);\n\n        return pattern;\n    }\n    // Gradient fill\n    else if (fillStyle.fill instanceof FillGradient)\n    {\n        const fillGradient = fillStyle.fill;\n\n        const isLinear = fillGradient.type === 'linear';\n        const isLocal = fillGradient.textureSpace === 'local';\n\n        let width = 1;\n        let height = 1;\n\n        // Use text dimensions if in local space\n        if (isLocal && textMetrics)\n        {\n            width = textMetrics.width + padding;\n            height = textMetrics.height + padding;\n        }\n\n        let gradient: CanvasGradient;\n        let isNearlyVertical = false;\n\n        if (isLinear)\n        {\n            const { start, end } = fillGradient;\n\n            gradient = context.createLinearGradient(\n                start.x * width,\n                start.y * height,\n                end.x * width,\n                end.y * height\n            );\n\n            // Check if gradient is nearly vertical (10% threshold)\n            isNearlyVertical = Math.abs(end.x - start.x) < Math.abs((end.y - start.y) * 0.1);\n        }\n        else\n        {\n            const { center, innerRadius, outerCenter, outerRadius } = fillGradient;\n\n            gradient = context.createRadialGradient(\n                center.x * width,\n                center.y * height,\n                innerRadius * width,\n                outerCenter.x * width,\n                outerCenter.y * height,\n                outerRadius * width\n            );\n        }\n\n        // For vertical gradients in local space, repeat gradient per text line\n        if (isNearlyVertical && isLocal && textMetrics)\n        {\n            const ratio = (textMetrics.lineHeight) / height;\n\n            for (let i = 0; i < textMetrics.lines.length; i++)\n            {\n                const start = ((i * textMetrics.lineHeight) + (padding / 2)) / height;\n\n                fillGradient.colorStops.forEach((stop) =>\n                {\n                    // Convert to global space\n                    const globalStop = start + (stop.offset * ratio);\n\n                    gradient.addColorStop(\n                        // fix to 5 decimal places to avoid floating point precision issues\n                        Math.floor(globalStop * PRECISION) / PRECISION,\n                        Color.shared.setValue(stop.color).toHex()\n                    );\n                });\n            }\n        }\n        else\n        {\n            // Standard global space gradient handling\n            fillGradient.colorStops.forEach((stop) =>\n            {\n                gradient.addColorStop(stop.offset, Color.shared.setValue(stop.color).toHex());\n            });\n        }\n\n        return gradient;\n    }\n\n    // #if _DEBUG\n    warn('FillStyle not recognised', fillStyle);\n    // #endif\n\n    return 'red';\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}