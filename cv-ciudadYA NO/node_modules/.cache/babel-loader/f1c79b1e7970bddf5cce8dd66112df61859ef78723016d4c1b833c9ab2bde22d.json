{"ast":null,"code":"import { ExtensionType } from '../../extensions/Extensions.mjs';\nimport { BigPool } from '../../utils/pool/PoolGroup.mjs';\nimport { BatchableMesh } from '../mesh/shared/BatchableMesh.mjs';\nimport { NineSliceGeometry } from './NineSliceGeometry.mjs';\n\"use strict\";\nclass NineSliceSpritePipe {\n  constructor(renderer) {\n    this._gpuSpriteHash = /* @__PURE__ */Object.create(null);\n    this._destroyRenderableBound = this.destroyRenderable.bind(this);\n    this._renderer = renderer;\n    this._renderer.renderableGC.addManagedHash(this, \"_gpuSpriteHash\");\n  }\n  addRenderable(sprite, instructionSet) {\n    const gpuSprite = this._getGpuSprite(sprite);\n    if (sprite.didViewUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n    this._renderer.renderPipes.batch.addToBatch(gpuSprite, instructionSet);\n  }\n  updateRenderable(sprite) {\n    const gpuSprite = this._gpuSpriteHash[sprite.uid];\n    if (sprite.didViewUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n    gpuSprite._batcher.updateElement(gpuSprite);\n  }\n  validateRenderable(sprite) {\n    const gpuSprite = this._getGpuSprite(sprite);\n    return !gpuSprite._batcher.checkAndUpdateTexture(gpuSprite, sprite._texture);\n  }\n  destroyRenderable(sprite) {\n    const batchableMesh = this._gpuSpriteHash[sprite.uid];\n    BigPool.return(batchableMesh.geometry);\n    BigPool.return(batchableMesh);\n    this._gpuSpriteHash[sprite.uid] = null;\n    sprite.off(\"destroyed\", this._destroyRenderableBound);\n  }\n  _updateBatchableSprite(sprite, batchableSprite) {\n    batchableSprite.geometry.update(sprite);\n    batchableSprite.setTexture(sprite._texture);\n  }\n  _getGpuSprite(sprite) {\n    return this._gpuSpriteHash[sprite.uid] || this._initGPUSprite(sprite);\n  }\n  _initGPUSprite(sprite) {\n    const batchableMesh = BigPool.get(BatchableMesh);\n    batchableMesh.geometry = BigPool.get(NineSliceGeometry);\n    batchableMesh.renderable = sprite;\n    batchableMesh.transform = sprite.groupTransform;\n    batchableMesh.texture = sprite._texture;\n    batchableMesh.roundPixels = this._renderer._roundPixels | sprite._roundPixels;\n    this._gpuSpriteHash[sprite.uid] = batchableMesh;\n    if (!sprite.didViewUpdate) {\n      this._updateBatchableSprite(sprite, batchableMesh);\n    }\n    sprite.on(\"destroyed\", this._destroyRenderableBound);\n    return batchableMesh;\n  }\n  destroy() {\n    for (const i in this._gpuSpriteHash) {\n      const batchableMesh = this._gpuSpriteHash[i];\n      batchableMesh.geometry.destroy();\n    }\n    this._gpuSpriteHash = null;\n    this._renderer = null;\n  }\n}\n/** @ignore */\nNineSliceSpritePipe.extension = {\n  type: [ExtensionType.WebGLPipes, ExtensionType.WebGPUPipes, ExtensionType.CanvasPipes],\n  name: \"nineSliceSprite\"\n};\nexport { NineSliceSpritePipe };","map":{"version":3,"names":["NineSliceSpritePipe","constructor","renderer","_gpuSpriteHash","Object","create","_destroyRenderableBound","destroyRenderable","bind","_renderer","renderableGC","addManagedHash","addRenderable","sprite","instructionSet","gpuSprite","_getGpuSprite","didViewUpdate","_updateBatchableSprite","renderPipes","batch","addToBatch","updateRenderable","uid","_batcher","updateElement","validateRenderable","checkAndUpdateTexture","_texture","batchableMesh","BigPool","return","geometry","off","batchableSprite","update","setTexture","_initGPUSprite","get","BatchableMesh","NineSliceGeometry","renderable","transform","groupTransform","texture","roundPixels","_roundPixels","on","destroy","i","extension","type","ExtensionType","WebGLPipes","WebGPUPipes","CanvasPipes","name"],"sources":["C:\\Users\\emalv\\OneDrive\\Desktop\\Portafolio\\cv-ciudad\\node_modules\\pixi.js\\src\\scene\\sprite-nine-slice\\NineSliceSpritePipe.ts"],"sourcesContent":["import { ExtensionType } from '../../extensions/Extensions';\nimport { BigPool } from '../../utils/pool/PoolGroup';\nimport { BatchableMesh } from '../mesh/shared/BatchableMesh';\nimport { NineSliceGeometry } from './NineSliceGeometry';\n\nimport type { InstructionSet } from '../../rendering/renderers/shared/instructions/InstructionSet';\nimport type { RenderPipe } from '../../rendering/renderers/shared/instructions/RenderPipe';\nimport type { Renderer } from '../../rendering/renderers/types';\nimport type { PoolItem } from '../../utils/pool/Pool';\nimport type { Container } from '../container/Container';\nimport type { NineSliceSprite } from './NineSliceSprite';\n\nexport class NineSliceSpritePipe implements RenderPipe<NineSliceSprite>\n{\n    /** @ignore */\n    public static extension = {\n        type: [\n            ExtensionType.WebGLPipes,\n            ExtensionType.WebGPUPipes,\n            ExtensionType.CanvasPipes,\n        ],\n        name: 'nineSliceSprite',\n    } as const;\n\n    private readonly _renderer: Renderer;\n    private readonly _gpuSpriteHash: Record<number, BatchableMesh> = Object.create(null);\n    private readonly _destroyRenderableBound = this.destroyRenderable.bind(this) as (renderable: Container) => void;\n\n    constructor(renderer: Renderer)\n    {\n        this._renderer = renderer;\n        this._renderer.renderableGC.addManagedHash(this, '_gpuSpriteHash');\n    }\n\n    public addRenderable(sprite: NineSliceSprite, instructionSet: InstructionSet)\n    {\n        const gpuSprite = this._getGpuSprite(sprite);\n\n        if (sprite.didViewUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n\n        this._renderer.renderPipes.batch.addToBatch(gpuSprite, instructionSet);\n    }\n\n    public updateRenderable(sprite: NineSliceSprite)\n    {\n        const gpuSprite = this._gpuSpriteHash[sprite.uid];\n\n        if (sprite.didViewUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n\n        gpuSprite._batcher.updateElement(gpuSprite);\n    }\n\n    public validateRenderable(sprite: NineSliceSprite): boolean\n    {\n        const gpuSprite = this._getGpuSprite(sprite);\n\n        return !gpuSprite._batcher.checkAndUpdateTexture(\n            gpuSprite,\n            sprite._texture\n        );\n    }\n\n    public destroyRenderable(sprite: NineSliceSprite)\n    {\n        const batchableMesh = this._gpuSpriteHash[sprite.uid];\n\n        // this will call reset!\n        BigPool.return(batchableMesh.geometry as PoolItem);\n        BigPool.return(batchableMesh as PoolItem);\n\n        this._gpuSpriteHash[sprite.uid] = null;\n\n        sprite.off('destroyed', this._destroyRenderableBound);\n    }\n\n    private _updateBatchableSprite(sprite: NineSliceSprite, batchableSprite: BatchableMesh)\n    {\n        (batchableSprite.geometry as NineSliceGeometry)\n            .update(sprite);\n\n        // = sprite.bounds;\n        batchableSprite.setTexture(sprite._texture);\n    }\n\n    private _getGpuSprite(sprite: NineSliceSprite): BatchableMesh\n    {\n        return this._gpuSpriteHash[sprite.uid] || this._initGPUSprite(sprite);\n    }\n\n    private _initGPUSprite(sprite: NineSliceSprite): BatchableMesh\n    {\n        const batchableMesh = BigPool.get(BatchableMesh);\n\n        batchableMesh.geometry = BigPool.get(NineSliceGeometry);\n        batchableMesh.renderable = sprite;\n        batchableMesh.transform = sprite.groupTransform;\n        batchableMesh.texture = sprite._texture;\n        batchableMesh.roundPixels = (this._renderer._roundPixels | sprite._roundPixels) as 0 | 1;\n\n        this._gpuSpriteHash[sprite.uid] = batchableMesh;\n\n        // if the sprite has not been updated by the view, we need to update the batchable mesh now.\n        if (!sprite.didViewUpdate)\n        {\n            this._updateBatchableSprite(sprite, batchableMesh);\n        }\n\n        // TODO perhaps manage this outside this pipe? (a bit like how we update / add)\n        sprite.on('destroyed', this._destroyRenderableBound);\n\n        return batchableMesh;\n    }\n\n    public destroy()\n    {\n        for (const i in this._gpuSpriteHash)\n        {\n            const batchableMesh = this._gpuSpriteHash[i];\n\n            batchableMesh.geometry.destroy();\n        }\n\n        (this._gpuSpriteHash as null) = null;\n        (this._renderer as null) = null;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}